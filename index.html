<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
    <meta name="author" content="" />
    <meta name="description" content="" />

    <!-- Don't forget to set your site up: http://google.com/webmasters -->
    <meta name="google-site-verification" content="" />

    <!-- Who owns the content of this site? -->
    <meta name="Copyright" content="" />

    <!--  Mobile Viewport
    http://j.mp/mobileviewport & http://davidbcalhoun.com/2010/viewport-metatag
    device-width : Occupy full width of the screen in its current orientation
    initial-scale = 1.0 retains dimensions instead of zooming out if page height > device height
    maximum-scale = 1.0 retains dimensions instead of zooming in if page width < device width (wrong for most sites)
    -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <style type="text/css">

        canvas {
            position: absolute;
            margin: auto;
            left: 0;
            right: 0;
            top: 0;
        }

        .button-side {
            width: 100px;
            height: 100px;
            position: relative;
            float: left;
            margin: 10px;
            border-radius: 10px;
            background-color: aqua;
        }
        #button-shoot {
            width: 100px;
            height: 100px;
            /*width: 80px;
            height: 80px;
            position: relative;
            float: right;*/
            position: absolute;
            margin: auto;
            left: 0;
            right: 0;
            top: 0;
            bottom: 0;
            border-radius: 50%;
            background-color: red;
        }

        .circle {
            width: 80px;
            height: 80px;
            position: absolute;
            margin: auto;
            left: 0;
            right: 0;
            top: 0;
            bottom: 0;
            border-radius: 50%;
        }
    
    </style>

</head>
<body>
    
    <div id="wrapper-mobile">
        <div id="container-buttons">
            <!--div class="button-side" id="button-left"></div>
            <div class="button-side" id="button-right"></div-->
            <div id="button-shoot"></div>
        </div>
    </div>

    <div id="wrapper-desktop">
        <div class="circle"></div>
    </div>




    <script src="/socket.io/socket.io.js"></script>
    
    <script>  
        var socket = io.connect('/');
        
        /* --------------------- Detect mobile ---------------------
        --------------------------------------------------------------- */
        isMobile = {
            Android: function() {
                return navigator.userAgent.match(/Android/i);
            },
            BlackBerry: function() {
                return navigator.userAgent.match(/BlackBerry/i);
            },
            iOS: function() {
                return navigator.userAgent.match(/iPhone|iPad|iPod/i);
            },
            Opera: function() {
                return navigator.userAgent.match(/Opera Mini/i);
            },
            Windows: function() {
                return navigator.userAgent.match(/IEMobile/i);
            },
            any: function() {
                return isMobile.Android() || isMobile.BlackBerry() || isMobile.iOS() || isMobile.Opera() || isMobile.Windows();
            }
        };

        function initPage() {
            /* --------------------- Control socket ---------------------
            --------------------------------------------------------------- */
            if (isMobile.any()) {
                $('#wrapper-desktop').hide();
                
                // Click button
                /*
                $('#button-left').click(function() {
                    socket.emit('event', { message: 'left' });
                });
                $('#button-right').click(function() {
                    socket.emit('event', { message: 'right' });
                });
                $('#button-shoot').click(function() {
                    socket.emit('event', { message: 'shoot' });
                });
                */
                $('#button-shoot').click(function(event) {
                    event.preventDefault();
                    socket.emit('event', { message: 'shoot' });
                });

                // Accelerometer
                window.ondevicemotion = function(event) {
                    var accelerationX = Math.floor(event.accelerationIncludingGravity.x * 20);
                    var accelerationY = Math.floor(event.accelerationIncludingGravity.y * 20);
                    var accelerationZ = Math.floor(event.accelerationIncludingGravity.z * 20);

                    socket.emit('event', { message: accelerationX + ',' + accelerationY + ',' + accelerationZ });
                }


            } else {
                $('#wrapper-mobile').hide();
                
                // Click button
                /*
                socket.on('event', function (data) {
                    console.log('socket.on:' + data.message);
                    switch(data.message) {
                        case 'left':
                            TweenMax.to($('.circle'), 0.5, {x:-200, ease:Power2.easeInOut});
                        break;
                        case 'right':
                            TweenMax.to($('.circle'), 0.5, {x:200, ease:Power2.easeInOut});
                        break;
                        case 'shoot':
                            console.log('SHOOT');
                        break;
                    }
                });*/
                // Accelerometer
                socket.on('event', function (data) {
                    var first = data.message.indexOf(",");
                    var strX = data.message.substring(0,first);
                    var secondString = data.message.substr(first + 1);
                    var second = secondString.indexOf(',');
                    var strY = secondString.substring(0,second);
                    var strZ = secondString.substr(second + 1)
                    
                    TweenMax.to($('.circle'), 0, {x:strX, y:strY, z:strZ});

                    if(data.message == "shoot") {
                        TweenMax.to($('.circle'), 0, {backgroundColor:'#FF0000', scaleX:0.3, scaleY: 0.3, ease:Power2.easeOut});
                    } else {
                        TweenMax.to($('.circle'), 0.5, {backgroundColor:'#00FFFF', scaleX:1, scaleY: 1, ease:Power2.easeOut});
                    }
                });
            }

            /* --------------------- Movement circle ---------------------
            --------------------------------------------------------------- */
            function moveCircle() {
                TweenMax.to($('.circle'), 2, {x:randomInt(-50,50), y:randomInt(-10,10), ease:Power2.easeInOut, onComplete:moveCircle});
            }

            //moveCircle();

        };


        /* --------------------- Auxiliar functions ---------------------
        --------------------------------------------------------------- */
        // RANDOM ARRAYS
        function shuffle(array) {
            var currentIndex = array.length, temporaryValue, randomIndex;

            while (0 !== currentIndex) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex -= 1;

                temporaryValue = array[currentIndex];
                array[currentIndex] = array[randomIndex];
                array[randomIndex] = temporaryValue;
            }
        return array;
        }

        // RANDOM NUMBERS
        function randomInt(min,max) {
            return Math.floor(Math.random()*(max-min+1)+min);
        }


        

    </script>
</body>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/gsap/1.18.4/TweenMax.min.js"></script>
    <script src="https://code.jquery.com/jquery-2.2.4.min.js"   integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="   crossorigin="anonymous"></script>

    <script>$(document).ready(initPage);</script>



</html>